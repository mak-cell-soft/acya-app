<div class="modal-header">
    <h2>Conversion en Facture</h2>
    <button mat-icon-button (click)="onCancel()">
        <mat-icon>close</mat-icon>
    </button>
</div>

<div class="modal-content">
    <div class="summary-section">
        <p><strong>Client:</strong> {{ document.counterpart.firstname }} {{ document.counterpart.lastname }}</p>
        <p><strong>Montant Total:</strong> {{ document.total_net_ttc | number:'1.3-3' }} TND</p>
        <p><strong>Référence BL:</strong> {{ document.docnumber }}</p>
    </div>

    <mat-divider></mat-divider>

    <div class="payment-status-section">
        <div *ngIf="hasPayment" class="status-success">
            <mat-icon>check_circle</mat-icon>
            <span>Paiement existant détecté.</span>
        </div>

        <div *ngIf="!hasPayment" class="status-warning">
            <mat-icon>warning</mat-icon>
            <span>Aucun paiement associé n'a été trouvé.</span>
            <p>Vous pouvez saisir un paiement maintenant ou continuer la conversion.</p>
            <button mat-stroked-button color="primary" (click)="openPaymentModal()">
                <mat-icon>payment</mat-icon>
                Saisir un Paiement
            </button>
        </div>
    </div>

    <div class="confirmation-text">
        <p>Voulez-vous transformer ce Bon de Livraison en Facture Client ?</p>
        <p class="note">Le Bon de Livraison original sera marqué comme facturé.</p>
    </div>
</div>

<div class="modal-actions">
    <button mat-button (click)="onCancel()">Annuler</button>
    <button mat-raised-button color="primary" (click)="onConvert()" [disabled]="isConverting">
        <mat-icon *ngIf="!isConverting">transform</mat-icon>
        <mat-spinner *ngIf="isConverting" diameter="20"></mat-spinner>
        <span *ngIf="!isConverting">Convertir</span>
        <span *ngIf="isConverting">Conversion...</span>
    </button>
</div>